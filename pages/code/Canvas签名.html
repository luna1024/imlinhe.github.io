<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Canvas 签名 | 林河前端之路</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/linhe.jpg">
    <meta name="description" content="前端笔记整理">
    <link rel="preload" href="/assets/css/0.styles.3db95324.css" as="style"><link rel="preload" href="/assets/js/app.8527a2dd.js" as="script"><link rel="preload" href="/assets/js/2.8f2c7423.js" as="script"><link rel="preload" href="/assets/js/35.3737bb0f.js" as="script"><link rel="prefetch" href="/assets/js/10.c4d163ab.js"><link rel="prefetch" href="/assets/js/11.23c17230.js"><link rel="prefetch" href="/assets/js/12.8d3df385.js"><link rel="prefetch" href="/assets/js/13.042941de.js"><link rel="prefetch" href="/assets/js/14.a0fea86b.js"><link rel="prefetch" href="/assets/js/15.d6799237.js"><link rel="prefetch" href="/assets/js/16.ce544b28.js"><link rel="prefetch" href="/assets/js/17.87a30d9f.js"><link rel="prefetch" href="/assets/js/18.660101a3.js"><link rel="prefetch" href="/assets/js/19.751bafc7.js"><link rel="prefetch" href="/assets/js/20.57c5d209.js"><link rel="prefetch" href="/assets/js/21.8971397f.js"><link rel="prefetch" href="/assets/js/22.3f77984b.js"><link rel="prefetch" href="/assets/js/23.f8df63d0.js"><link rel="prefetch" href="/assets/js/24.5aa0710c.js"><link rel="prefetch" href="/assets/js/25.098c2647.js"><link rel="prefetch" href="/assets/js/26.73da530b.js"><link rel="prefetch" href="/assets/js/27.c170c739.js"><link rel="prefetch" href="/assets/js/28.da4a830f.js"><link rel="prefetch" href="/assets/js/29.3c5f8234.js"><link rel="prefetch" href="/assets/js/3.35d75d16.js"><link rel="prefetch" href="/assets/js/30.4e8211dd.js"><link rel="prefetch" href="/assets/js/31.e782aacc.js"><link rel="prefetch" href="/assets/js/32.264733b0.js"><link rel="prefetch" href="/assets/js/33.102628ed.js"><link rel="prefetch" href="/assets/js/34.47b7d181.js"><link rel="prefetch" href="/assets/js/36.293a2556.js"><link rel="prefetch" href="/assets/js/37.39aba3fa.js"><link rel="prefetch" href="/assets/js/38.4297d876.js"><link rel="prefetch" href="/assets/js/39.901b8e8a.js"><link rel="prefetch" href="/assets/js/4.1a3fa213.js"><link rel="prefetch" href="/assets/js/40.fbbb2e08.js"><link rel="prefetch" href="/assets/js/41.17094594.js"><link rel="prefetch" href="/assets/js/42.08edd393.js"><link rel="prefetch" href="/assets/js/43.8869d7e5.js"><link rel="prefetch" href="/assets/js/44.163c6f23.js"><link rel="prefetch" href="/assets/js/45.429368d5.js"><link rel="prefetch" href="/assets/js/46.5242b107.js"><link rel="prefetch" href="/assets/js/5.d6f7b957.js"><link rel="prefetch" href="/assets/js/6.0efb20b8.js"><link rel="prefetch" href="/assets/js/7.b1f97683.js"><link rel="prefetch" href="/assets/js/8.1b77c896.js"><link rel="prefetch" href="/assets/js/9.2a969e21.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3db95324.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/linhe.jpg" alt="林河前端之路" class="logo"> <span class="site-name can-hide">林河前端之路</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/pages/blog/javascript/Webpack配置指南.html" class="nav-link">
  博文
</a></div><div class="nav-item"><a href="/pages/code/一行代码实现时间戳转时分秒.html" class="nav-link">
  代码块
</a></div><div class="nav-item"><a href="https://github.com/imlinhe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/pages/blog/javascript/Webpack配置指南.html" class="nav-link">
  博文
</a></div><div class="nav-item"><a href="/pages/code/一行代码实现时间戳转时分秒.html" class="nav-link">
  代码块
</a></div><div class="nav-item"><a href="https://github.com/imlinhe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>代码块</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/code/一行代码实现时间戳转时分秒.html" class="sidebar-link">一行代码实现时间戳转时分秒</a></li><li><a href="/pages/code/饿了么Dialog组件二次封装.html" class="sidebar-link">饿了么Dialog组件二次封装</a></li><li><a href="/pages/code/椭圆运动轨迹.html" class="sidebar-link">椭圆运动轨迹</a></li><li><a href="/pages/code/常用scss函数表.html" class="sidebar-link">常用scss函数表</a></li><li><a href="/pages/code/公共方法汇总.html" class="sidebar-link">公共方法汇总</a></li><li><a href="/pages/code/浮点数运算误差.html" class="sidebar-link">浮点数运算误差</a></li><li><a href="/pages/code/isEqual.html" class="sidebar-link">isEqual</a></li><li><a href="/pages/code/ESLint配置项.html" class="sidebar-link">ESLint配置项</a></li><li><a href="/pages/code/电话号码分段.html" class="sidebar-link">电话号码分段</a></li><li><a href="/pages/code/Canvas签名.html" class="active sidebar-link">Canvas签名</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="canvas-签名"><a href="#canvas-签名" class="header-anchor">#</a> Canvas 签名</h1> <p>根组件：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pug<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  //- orderNo 生成图片名称变量
  //- signUrl 图片地址
  SignatureAgree(
    :orderNo=&quot;orderNo&quot;
    :signUrl.sync=&quot;signUrl&quot;
  )
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>父组件：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pug<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  .signature-agreement-container
    .signature-container(@click=&quot;signatureHandle&quot;)
      img(v-if=&quot;signUrl&quot; :src=&quot;signUrl&quot;)
      p(v-else) 请仔细阅读并确认协议后进行签名
    drawContent(
      v-model=&quot;showDraw&quot;
      v-show=&quot;showDraw&quot;
      @confirm=&quot;confirmHandler&quot;
      :img-data=&quot;signUrl&quot;
    )
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> drawContent <span class="token keyword">from</span> <span class="token string">'./draw-content'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name      <span class="token operator">:</span> <span class="token string">'SignatureAgreement'</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    drawContent
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    signUrl<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    orderNo<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      showDraw<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 签名</span>
    <span class="token function">signatureHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>showDraw <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">confirmHandler</span><span class="token punctuation">(</span><span class="token parameter">base64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>showDraw <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
        base64 <span class="token operator">:</span> base64<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        imgName<span class="token operator">:</span> <span class="token string">'sign_'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>orderNo
      <span class="token punctuation">}</span>
      <span class="token comment">// 上传到 oss</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span>imgUrl<span class="token operator">:</span> signUrl<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$superAgent<span class="token punctuation">.</span><span class="token function">saveInputStreamByOss</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'update:signUrl'</span><span class="token punctuation">,</span> signUrl<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>less<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.signature-agreement-container</span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@body-background</span><span class="token punctuation">;</span></span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 20/<span class="token atrule"><span class="token rule">@base</span> 30/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span></span>
  <span class="token selector">.signature-container</span> <span class="token punctuation">{</span>
    <span class="token property">margin-top</span><span class="token punctuation">:</span> 20/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 8/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 270/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
    <span class="token selector">img</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">p</span> <span class="token punctuation">{</span>
      <span class="token property">line-height</span><span class="token punctuation">:</span> 270/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
      <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.submit-container</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 184/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
    <span class="token property">background</span><span class="token punctuation">:</span><span class="token function">linear-gradient</span><span class="token punctuation">(</span>180deg<span class="token punctuation">,</span>#FCFCFC 0%<span class="token punctuation">,</span><span class="token atrule"><span class="token rule">@body-background</span> 100%<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 48/<span class="token atrule"><span class="token rule">@base</span> 30/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span></span>
    <span class="token selector">button</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 32/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
      <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
      <span class="token property">line-height</span><span class="token punctuation">:</span> 88/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
      <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token property">border-radius</span><span class="token punctuation">:</span> 44/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@primary-color</span><span class="token punctuation">;</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>子组件：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pug<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  .draw-content
    .sign-canvas(id='canvasBox')
      .sign-canvas-content
        .canvas-top(id='top')
          .canvas-button-left
            button.button-rotate.font-size-32.cancel(@click='canvasShow') 取消
          .canvas-button-right
            button.button-rotate.font-size-32.submit(@click='confirm',:class='{primary:lastX !== -1}') 确认
            button.button-rotate.font-size-32(@click='reset') 重置
        .canvas-box
          canvas(ref=&quot;sign&quot; @touchmove=&quot;onTouchMove&quot; @touchstart=&quot;onTouchStart&quot; @touchend=&quot;onTouchEnd&quot;)
          canvas(ref=&quot;rotate&quot; v-show=&quot;false&quot;)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name <span class="token operator">:</span> <span class="token string">'DrawContent'</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'value'</span><span class="token punctuation">,</span> <span class="token string">'imgData'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        lastX     <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        lastY     <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
        ctx       <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        offsetTop <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        offsetLeft<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        canvas    <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        signShow  <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        img       <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        isInit    <span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    watch<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isInit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>isInit <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchmove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>preventDefault<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">// 禁用滚动</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'touchmove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>preventDefault<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">// 滚动</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">canvasShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 签名开启关闭</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">let</span> show <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>value
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> show<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">onTouchMove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastX <span class="token operator">=</span> e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageX
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastY <span class="token operator">=</span> e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageY
        e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">onTouchStart</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastX <span class="token operator">=</span> e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageX
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastY <span class="token operator">=</span> e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageY
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">onTouchEnd</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token parameter">touches</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">10</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> <span class="token string">'round'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">'#1ab499'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetLeft<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetTop<span class="token punctuation">)</span><span class="token comment">// 不画线</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>touches<span class="token punctuation">.</span>pageX <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetLeft<span class="token punctuation">,</span> touches<span class="token punctuation">.</span>pageY <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetTop<span class="token punctuation">)</span><span class="token comment">// 画线</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastX <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token comment">// 清空初始化</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastY <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#fff'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lastX <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 当没有签名的时候确认按钮不可用</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span>
        img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> height <span class="token operator">=</span> img<span class="token punctuation">.</span>height
          <span class="token keyword">let</span> width <span class="token operator">=</span> img<span class="token punctuation">.</span>width
          <span class="token keyword">let</span> canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>rotate
          <span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
          canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> height
          canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> width
          ctx<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">90</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span>
          ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>height<span class="token punctuation">)</span>
          <span class="token keyword">let</span> base <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'confirm'</span><span class="token punctuation">,</span> base<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">initDraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>sign
        <span class="token keyword">this</span><span class="token punctuation">.</span>offsetTop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>parentElement<span class="token punctuation">.</span>offsetTop
        <span class="token keyword">this</span><span class="token punctuation">.</span>offsetLeft <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>parentElement<span class="token punctuation">.</span>offsetLeft
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>parentElement<span class="token punctuation">.</span>clientWidth<span class="token punctuation">)</span><span class="token comment">// 内部像素和css像素不一致 所以要这么写</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>parentElement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
        <span class="token comment">// 背景色 背景填充</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#fff'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>signShow <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>stylesheet/less<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token atrule"><span class="token rule">@base-color</span><span class="token punctuation">:</span> #21C9AD<span class="token punctuation">;</span></span>
  <span class="token selector">.draw-content</span><span class="token punctuation">{</span>
    <span class="token selector">.sign-canvas</span><span class="token punctuation">{</span>
      <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@global-padding</span><span class="token punctuation">;</span></span>
      <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token property">z-index</span><span class="token punctuation">:</span> 9999<span class="token punctuation">;</span>
      <span class="token property">background-color</span><span class="token punctuation">:</span> #f8f8f8<span class="token selector">;
      .sign-canvas-content</span><span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token selector">;
        .canvas-top</span><span class="token punctuation">{</span>
          <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
          <span class="token property">width</span><span class="token punctuation">:</span> 15%<span class="token punctuation">;</span>
          <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
          <span class="token property">flex-direction</span><span class="token punctuation">:</span> column-reverse<span class="token punctuation">;</span>
          <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
          <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
          <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
          <span class="token property">margin-right</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@global-padding</span><span class="token punctuation">;</span></span>
          <span class="token selector">.canvas-button-left</span> <span class="token punctuation">{</span>
            <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-90deg<span class="token punctuation">)</span> <span class="token function">translateX</span><span class="token punctuation">(</span>50/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
          <span class="token punctuation">}</span>
          <span class="token selector">.canvas-button-right</span> <span class="token punctuation">{</span>
            <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
            <span class="token property">flex-direction</span><span class="token punctuation">:</span> row-reverse<span class="token punctuation">;</span>
            <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-90deg<span class="token punctuation">)</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-150/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
          <span class="token punctuation">}</span>
          <span class="token selector">.button-rotate</span><span class="token punctuation">{</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 88/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 176/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
            <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@base-color</span><span class="token punctuation">;</span></span>
            <span class="token property">border-radius</span><span class="token punctuation">:</span> 45/<span class="token atrule"><span class="token rule">@base</span><span class="token punctuation">;</span></span>
            <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token selector">;
            &amp;.cancel</span> <span class="token punctuation">{</span>
              <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
              <span class="token property">color</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@base-color</span><span class="token punctuation">;</span></span>
              <span class="token property">border</span><span class="token punctuation">:</span> 2/<span class="token atrule"><span class="token rule">@base</span> solid <span class="token atrule"><span class="token rule">@base-color</span><span class="token punctuation">;</span></span></span>
            <span class="token punctuation">}</span>
            <span class="token selector">&amp;.submit</span> <span class="token punctuation">{</span>
              <span class="token property">margin-left</span><span class="token punctuation">:</span> <span class="token atrule"><span class="token rule">@global-padding</span><span class="token punctuation">;</span></span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.canvas-box</span><span class="token punctuation">{</span>
          <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
          <span class="token property">width</span><span class="token punctuation">:</span> 85%<span class="token punctuation">;</span>
          <span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/code/电话号码分段.html" class="prev">
        电话号码分段
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.8527a2dd.js" defer></script><script src="/assets/js/2.8f2c7423.js" defer></script><script src="/assets/js/35.3737bb0f.js" defer></script>
  </body>
</html>
